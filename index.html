<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SportScore</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SportScore">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-orientations" content="portrait">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>
<!-- ê²Œì„ ì„ íƒ í™”ë©´ -->
<div id="gameSelection" class="screen">
    <div style="display:flex;align-items:center;gap:0.5rem;width:100%;justify-content:space-between;">
        <img src="images/SportScore.webp" alt="Sport Score ë¡œê³ "
             style="height: auto; max-width: 120px; padding:1px; margin:0.1;">

        <!--        <h1 style="margin:0;">Sport Score</h1>-->

        <button id="gameMenuBtn" class="control-btn"
                style="width:auto;height:auto;padding:8px 10px;border-radius:10px;"
                onclick="toggleGameMenu()"
                title="ë©”ë‰´(Menu)">â˜°
        </button>
    </div>

    <div id="gameMenu"
         style="display:none;position:absolute;top:56px;right:20px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);padding:8px;z-index:1200;">
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="openSavedNamesManager();toggleGameMenu()">ì„ ìˆ˜ ê´€ë¦¬(Players)
        </button>
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="showHistory();toggleGameMenu()">ê¸°ë¡ ë³´ê¸°(Match record)
        </button>
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="showScreen('voiceLanguage');toggleGameMenu()">ìŒì„± ì•ˆë‚´(Text2Speech)
        </button>
        <!-- "ìŒì„±ì¸ì‹ ì„¤ì •" ë²„íŠ¼ ì¶”ê°€ -->
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="showScreen('voiceSettings');toggleGameMenu()">ìŒì„± ì¸ì‹(Voice2Score)
        </button>
        <!-- ... ê¸°ì¡´ 'ê²½ê¸°ê¸°ë¡', 'ì•± ì •ë³´' ë²„íŠ¼ ... -->

        <button class="modal-action" style="display:block;width:100%;"
                onclick="showAbout();toggleGameMenu()">About
        </button>
    </div>

    <div class="game-buttons">
        <button class="game-btn" onclick="displayGameInfo('badminton')" type="button">
            <div class="game-icon">ğŸ¸</div>
            <div class="game-name">ë°°ë“œë¯¼í„´<br>Badminton</div>
        </button>
        <button class="game-btn" onclick="displayGameInfo('pingpong')" type="button">
            <div class="game-icon">ğŸ“</div>
            <div class="game-name">íƒêµ¬<br>TableTennis</div>
        </button>
        <button class="game-btn" onclick="displayGameInfo('jokgu')" type="button">
            <div class="game-icon">âš½ï¸</div>
            <div class="game-name">ì¡±êµ¬<br>Jokgu</div>
        </button>
        <button class="game-btn" onclick="displayGameInfo('pickleball')" type="button">
            <div class="game-icon">ğŸ¥’</div>
            <div class="game-name">í”¼í´ë³¼<br>PickleBall</div>
        </button>
        <button class="start-btn-modern" onclick="showGameSettings()">ê²Œì„ ì„¤ì •(Game settings)</button>
    </div>
    <!-- ê²½ê¸° ê·œì¹™ ì„¤ëª… ì˜ì—­ -->
    <div id="ruleDisplay" class="rule-display-container">
        <img id="ruleDisplayImage" src="" alt="Game Image" class="rule-display-image">
        <div id="ruleDisplayDescription" class="rule-display-description"></div>
        <button class="start-btn-modern" onclick="showGameSettings()">ê²Œì„ ì„¤ì •(Game settings)</button>
    </div>
</div>

<!-- "ìŒì„±ì¸ì‹ ì„¤ì •" í™”ë©´ ìƒˆë¡œ ì¶”ê°€ -->
<div id="voiceSettings" class="screen">
    <header class="settings-header">
        <button class="back-btn" onclick="showGameSelection()" title="ì´ì „(Back)">â†</button>
        <h1>ìŒì„±ì¸ì‹ ì„¤ì •(Voice recognition settings)</h1>
    </header>
    <div class="content-body">
        <div class="settings-card">
            <h2>ìŒì„±ì¸ì‹ í…ŒìŠ¤íŠ¸</h2>
            <p class="description">
                ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  "ë¸”ë£¨íŒ€" ë˜ëŠ” "ë ˆë“œíŒ€"ë¼ê³  ë°œìŒí•´ë³´ì„¸ìš”.<br>
                Click the button below and pronounce it as "blue team" or "red team"<br>

                ì •í™•í•œ ë°œìŒ ì•ˆë‚´ë¥¼ ìœ„í•´ ë‹¨ì–´ë¥¼ ëˆŒëŸ¬ ë“¤ì–´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                You can click on a word to hear its pronunciation for accurate pronunciation
                guidance.<br>

                ì£¼ì˜) ì‹œë„ëŸ¬ìš´ ì¥ì†Œì—ì„œëŠ” ì‚¬ìš©ì„ ìì œí•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. <br>
                Caution) Please refrain from using in noisy places.
            </p>
            <div class="voice-test-area">
                <button id="voiceTestBtn" class="modern-btn-mic">ğŸ¤ ë°œìŒ í…ŒìŠ¤íŠ¸(pronunciation test)
                </button>
                <p>ì¸ì‹ëœ ë‹¨ì–´(recognized words): <span id="recognizedWord"
                                                   class="highlight-text">...</span></p>
            </div>
            <div class="voice-guide-area">
                <p>ë°œìŒ ì•ˆë‚´ (í´ë¦­í•˜ì—¬ ë“£ê¸°):<br>
                    Pronunciation Guide (Click to Listen)
                </p>
                <button class="chip-btn" onclick="testVoice('ë¸”ë£¨íŒ€')">ë¸”ë£¨íŒ€(blue team)</button>
                <button class="chip-btn" onclick="testVoice('ë ˆë“œíŒ€')">ë ˆë“œíŒ€(red team)</button>
            </div>
        </div>
    </div>
</div>

<!-- ê²Œì„ ì„¤ì • í™”ë©´ -->
<!--    <div id="gameSettings" class="screen">-->
<!--        <header class="settings-header">-->
<!--            <button class="back-btn" onclick="showGameSelection()" title="ì´ì „(Back)">â†</button>-->
<!--            <h1 id="selectedGameTitle">ê²Œì„ ì„¤ì •</h1>-->
<!--        </header>-->
<div id="gameSettings" class="screen">
    <header class="settings-header"
            style="display: flex; justify-content: space-between; align-items: center; padding: 0 16px;">
        <button class="back-btn" onclick="showGameSelection()" title="ì´ì „(Back)">â†</button>
        <h1 id="selectedGameTitle"
            style="margin: 0; font-size: 1.25rem; position: relative; left: 40%; transform: translateX(-50%);">
            ê²½ê¸° ì§„í–‰(Game settings)</h1>
        <button class="start-btn-modern1" onclick="startGame()"
                style="margin-left: auto; padding: 8px 16px; font-size: 14px;">ì‹œì‘<br>(Start)
        </button>
    </header>
    <div class="settings-content">
        <section class="settings-card">
            <h2>ê²Œì„ ê·œì¹™(Game rules)</h2>
            <div class="setting-item">
                <label for="winScoreRange">ìŠ¹ë¦¬ ì ìˆ˜(victory score)</label>
                <div class="slider-wrapper">
                    <span class="slider-value" id="winScoreValue">11</span>
                    <div class="slider-container">
                        <span class="slider-label-start">1</span>
                        <input type="range" id="winScoreRange" min="1" max="25" value="11">
                        <span class="slider-label-end">25</span>
                    </div>
                </div>
            </div>
            <div class="setting-item">
                <label for="totalSetsRange">ì´ ì„¸íŠ¸ ìˆ˜(Total number of sets)</label>
                <div class="slider-wrapper">
                    <span class="slider-value" id="totalSetsValue">3</span>
                    <div class="slider-container">
                        <span class="slider-label-start">1</span>
                        <input type="range" id="totalSetsRange" min="1" max="7" step="2" value="3">
                        <span class="slider-label-end">7</span>
                    </div>
                </div>
            </div>
            <div class="setting-item" id="matchTypeGroup">
                <label>ê²½ê¸° ë°©ì‹(How to Play)</label>
                <div class="radio-group-modern">
                    <input type="radio" id="single" name="matchType" value="single" checked>
                    <label for="single">ë‹¨ì‹(Single)</label>
                    <input type="radio" id="double" name="matchType" value="double">
                    <label for="double">ë³µì‹(Doubles)</label>
                </div>
            </div>
        </section>
        <section class="settings-card">
            <h2>ì„ ìˆ˜ ë“±ë¡(Player registration)</h2>
    <!-- ë¸”ë£¨íŒ€: ë¸”ë£¨íŒ€(BlueTeam) -->
    <div class="player-input-group blue-team">
        <label for="playerReg1">ë¸”ë£¨íŒ€(BlueTeam)</label>
        <input type="text" id="playerReg1"
               placeholder="ë¸”ë£¨íŒ€(BlueTeam)" maxlength="20">
        <button class="list-btn" onclick="openPlayerNamesPicker('playerReg1')">ğŸ“–</button>
    </div>

    <!-- ë ˆë“œíŒ€: ë ˆë“œíŒ€(RedTeam) -->
    <div class="player-input-group red-team">
        <label for="playerReg2">ë ˆë“œíŒ€(RedTeam)</label>
        <input type="text" id="playerReg2"
               placeholder="ë ˆë“œíŒ€(RedTeam)" maxlength="20">
        <button class="list-btn" onclick="openPlayerNamesPicker('playerReg2')">ğŸ“–</button>
    </div>
            <button class="apply-btn" onclick="applyPlayerNames()">ì´ë¦„ ì ìš©(Apply name)</button>
        </section>
        <section class="settings-card">
            <h2>ì˜µì…˜(Option)</h2>
            <div class="setting-item">
                <label for="setMemoInput">ê²½ê¸° ë©”ëª¨(match notes)</label>
                <input type="text" id="setMemoInput" class="text-input-modern"
                       placeholder="ì´ë²ˆ ê²½ê¸°ì— ëŒ€í•œ ë©”ëª¨(Notes on this match)" maxlength="40">
            </div>
            <div class="setting-item">
                <label for="voiceRecToggle">ìŒì„±ì¸ì‹ ì‚¬ìš©(Use voice recognition)</label>
                <label class="switch">
                    <input type="checkbox" id="voiceRecToggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <!--            </div>-->
            <div class="setting-item">
                <label for="enableRecording">ë™ì˜ìƒ ë…¹í™”(Video recording)</label>
                <label class="switch"><input type="checkbox" id="enableRecording">
                    <span class="slider round"></span>
                </label>
            </div>
            <div id="recordingOptions" style="display: none;">
                <div class="setting-item">
                    <label for="includeAudio">ì˜¤ë””ì˜¤ í¬í•¨(Include audio)</label>
                    <label class="switch"><input type="checkbox" id="includeAudio">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label for="cameraFacing">ì¹´ë©”ë¼(Camera)</label>
                    <select id="cameraFacing" class="text-input-modern">
                        <option value="user">ì „ë©´(Front)</option>
                        <option value="environment">í›„ë©´(Rear)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="recordQuality">í™”ì§ˆ(Quality)</label>
                    <select id="recordQuality" class="text-input-modern">
                        <option value="medium">ì¤‘ê°„(Middle)</option>
                        <option value="low">ë‚®ìŒ(Low)</option>
                        <option value="high">ë†’ìŒ(High)</option>
                    </select>
                </div>
            </div>
        </section>
        <button class="start-btn-modern" onclick="startGame()">ê²Œì„ ì‹œì‘(Start game)</button>
    </div>
</div>

<!-- ì ìˆ˜íŒ í™”ë©´ -->
<div id="scoreboard" class="screen">
    <div id="gameNotification" class="game-notification"></div>
    <!-- ìƒë‹¨ ë°” (ê°€ë¡œ ëª¨ë“œìš©) -->
    <div class="scoreboard-top-bar">
        <div class="game-info">
            <span id="gameNameDisplay">-</span>
            <span id="currentTimeDisplay">00:00</span>
            <span id="elapsedTimeDisplay">00:00:00</span>
        </div>
        <div class="scoreboard-main-controls">
            <button id="voiceControlBtn" class="control-btn" style="display: none;">ğŸ¤</button>
            <button id="recordStopButton" class="control-btn" title="ë…¹í™” ì¼ì‹œì •ì§€">âšâš</button>
            <div class="menu-container">
                <button id="scoreboardMenuButton" class="control-btn" title="ë©”ë‰´">â˜°</button>
                <div id="scoreboardMenu" class="menu-dropdown">
                    <button data-action="showGameSelection">ğŸ  í™ˆ(Home)</button>
                    <button data-action="resetSet">ğŸ”„ ì„¸íŠ¸ ë¦¬ì…‹(Set reset)</button>
                    <button data-action="undoLastScore">â†©ï¸ ì ìˆ˜ ìˆ˜ì •(Score undo)</button>
                    <button data-action="switchCourt">ğŸ”ƒ ì½”íŠ¸ êµì²´(Change court)</button>
                    <button data-action="showAbout">â„¹ï¸ About</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì ìˆ˜ ì˜ì—­ -->
    <div class="scoreboard-main-area">
        <div class="player-score" id="player1Score" role="button" tabindex="0">
            <div class="player-info">
                <span class="player-name" id="pn1">BlueTeam</span>
                <span class="set-score">(Sets: <span id="player1SetsInline">0</span>)</span>
            </div>
            <div class="score-display" id="score1">0</div>
        </div>
        <div class="player-score" id="player2Score" role="button" tabindex="0">
            <div class="player-info">
                <span class="player-name" id="pn2">RedTeam</span>
                <span class="set-score">(Sets: <span id="player2SetsInline">0</span>)</span>
            </div>
            <div class="score-display" id="score2">0</div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë²„íŠ¼ë“¤ (ì„¸ë¡œ ëª¨ë“œìš©) -->
    <div class="control-buttons">
        <button class="control-btn" onclick="showGameSelection()" type="button"
                title="ğŸ  í™ˆ(Home)"></button>
        <button class="control-btn" onclick="resetSet()" type="button"
                title="ğŸ”„ ì„¸íŠ¸ ë¦¬ì…‹(Set reset)"></button>
        <button class="control-btn" onclick="undoLastScore()" type="button"
                title="â†©ï¸ ì ìˆ˜ ìˆ˜ì •(Score undo)"></button>
        <button class="control-btn" onclick="switchCourt()" type="button"
                title="ğŸ”ƒ ì½”íŠ¸ êµì²´(Change court)"></button>
        <button class="control-btn" onclick="showAbout()"
                type="button" title="About">â„¹ï¸</button>
    </div>
</div>

<!-- ìŒì„± ì„¤ì • ëª¨ë‹¬ -->
<div id="voiceLanguage" class="screen">
    <header class="settings-header">
        <button class="back-btn" onclick="showGameSelection()" title="ì´ì „(Back)">â†</button>
        <h1>ìŒì„± ì•ˆë‚´ ì„¤ì •(Voice guidance settings)</h1>
    </header>
    <div class="content-body">
        <div class="settings-card">
            <!--        <button class="modal-close" onclick="closevoiceLanguage()">&times;</button>-->
            <h2>ìŒì„± ì„¤ì •(Voice setting)</h2>
            <p class="description">
                ìŒì„±ì•ˆë‚´ ì–¸ì–´(ì˜ì–´/í•œêµ­ì–´)ë¥¼ ì„ íƒí•˜ì„¸ìš”.<br>
                Select the voice guidance language (English/Korean)<br>
                ëª©ì†Œë¦¬, ë°œìŒ ì†ë„, ìŒë†’ì´ë¥¼ ì„ íƒí•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                You can check by selecting voice, pronunciation speed, and pitch.
            </p>

            <div class="voice-settings-columns">
                <section class="settings-card">
                    <div class="setting-item">
                        <label for="voiceLangSelect">ì–¸ì–´(Voice language)</label>
                        <select id="voiceLangSelect" class="text-input-modern">
                            <option value="ko-KR">í•œêµ­ì–´(Korean)</option>
                            <option value="en-US">English (US)</option>
                        </select></div>
                    <div class="setting-item"><label for="voiceSelect">ëª©ì†Œë¦¬(Voice)</label>
                        <select id="voiceSelect" class="text-input-modern">
                            <option value="">ê¸°ë³¸(Basic)</option>
                        </select></div>
                </section>
                <section class="settings-card">
                    <div class="setting-item">
                        <label for="rateRange">ì†ë„(Speed)</label>
                        <div class="slider-wrapper">
                            <span id="rateValue">1.0</span>
                            <input type="range" id="rateRange" min="0.5" max="2" step="0.1"
                                   value="1">
                        </div>
                    </div>
                    <div class="setting-item"><label for="pitchRange">ìŒë†’ì´(Pitch)</label>
                        <div class="slider-wrapper"><span id="pitchValue">1.0</span><input
                                type="range"
                                id="pitchRange"
                                min="0"
                                max="2"
                                step="0.1"
                                value="1">
                        </div>
                    </div>
                    <button class="modal-action" onclick="speakPreview()">ì†Œë¦¬ ì¬ìƒ(Play sound)</button>
                </section>
            </div>
        </div>
    </div>
</div>
<!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
<div id="gameEnd" class="screen">
    <canvas id="confettiCanvas"></canvas>
    <audio id="victorySound" src="sounds/victory.mp3"></audio>
    <!-- Replace with actual sound file path -->
    <div class="winner-card">
        <h1>VICTORY</h1>
        <div class="winner-name-large" id="winnerText"></div>
        <p class="final-score-display">
            <span id="player1DisplayName"></span> <strong id="finalScore"></strong> - <strong
                id="finalScore2"></strong> <span id="player2DisplayName"></span>
        </p>
    </div>
    <div class="end-buttons">
        <button class="end-btn" onclick="showGameSelection()">í™ˆìœ¼ë¡œ(Home)</button>
        <button class="end-btn" onclick="showGameSettings()">ìƒˆ ê²Œì„(New Game)</button>
    </div>
</div>

<!-- About ëª¨ë‹¬ -->
<div id="aboutModal" class="modal">
    <div class="modal-content">
        <!--        <button class="modal-close" onclick="closeAboutModal()" aria-label="ë‹«ê¸°(Close)">&times;-->
        <!--        </button>-->
        <h2>SportScore</h2>
        <p>ë²„ì „(Version): <strong>v1.5</strong></p>
        <p>ì œì‘(creation): <strong>song2ne</strong></p>
        <p>ë¬¸ì˜(Inquiry): <a href="mailto:songgs@song2nes.com">songgs@song2nes.com</a></p>
        <div class="modal-footer">
            <button class="modal-action" onclick="closeAboutModal()">í™•ì¸(OK)</button>
        </div>
    </div>
</div>

<!-- History ëª¨ë‹¬ -->
<div id="historyModal" class="modal">
    <div class="modal-content" style="width: 95vw; max-width: 600px;">
        <h2>ê²½ê¸° ê¸°ë¡</h2>
        <div id="historyList" style="max-height: 70vh; overflow-y: auto; margin-top: 1rem;">
            <!-- ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”ëœ ê²½ê¸° ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
        </div>
        <div class="modal-footer">
            <button class="modal-action" onclick="importHistory()">ê°€ì ¸ì˜¤ê¸°(Import)</button>
            <button class="modal-action destructive" onclick="clearHistory()">ì „ì²´ ì‚­ì œ(Delete all)</button>
            <button class="modal-action" onclick="closeHistoryModal()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>

<!-- QR Scanner Modal -->
<div id="qrScannerModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0;">ê²½ê¸° ê¸°ë¡ QR ì½”ë“œ ìŠ¤ìº”<br>Scan QR Code for Match Records</h2>
        <p>ê°€ì ¸ì˜¬ ê²½ê¸° ê¸°ë¡ì„ ì„ íƒí•˜ì„¸ìš”.<br>Select match records to import.</p>
        <p>ê²½ê¸° ê¸°ë¡ ê³µìœ  QRì— ì¹´ë©”ë¼ë¥¼ ë§ì¶”ì„¸ìš”.<br>Align the QR code within the camera frame.</p>
        <p>ê²½ê¸° ê¸°ë¡ì´ ìë™ ì €ì¥ ë©ë‹ˆë‹¤.<br>Records are saved automatically.</p>
        <div id="qr-reader" style="width: 100%;"></div>
        <div id="qr-reader-results"></div>
        <div class="modal-footer">
            <button class="modal-action" onclick="closeQrScannerModal()">ì·¨ì†Œ(Cancel)</button>
        </div>
    </div>
</div>


<!-- Saved Names Manager ëª¨ë‹¬ -->
<div id="savedNamesModal" class="modal">
    <div class="modal-content" style="width: 95vw; max-width: 400px;">
        <h2>ì„ ìˆ˜ ê´€ë¦¬ <span class="eng-text">(Player Management)</span></h2>

        <div class="player-input-group">
            <input type="text" id="newSavedName" placeholder="ì´ë¦„ ì…ë ¥(Enter name)">
            <button class="apply-btn" onclick="savePlayer()">ì €ì¥(Save)</button>
        </div>

        <div id="totalStatsSummary" style="margin-top: 10px; font-size: 0.9rem; color: #555;">
        </div>

        <div id="savedNamesList" style="max-height: 50vh; overflow-y: auto; margin-top: 1rem; border-top: 1px solid #eee;">
        </div>

        <div class="modal-footer">
            <button class="modal-action" onclick="closeSavedNamesManager()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>
<!--<div id="savedNamesModal" class="modal">-->
<!--    <div class="modal-content" style="width: 95vw; max-width: 400px;">-->
<!--        &lt;!&ndash;        <button class="modal-close" onclick="closeSavedNamesManager()" aria-label="ë‹«ê¸°(Close)">&ndash;&gt;-->
<!--        &lt;!&ndash;            &times;&ndash;&gt;-->
<!--        &lt;!&ndash;        </button>&ndash;&gt;-->
<!--        <h2>ì„ ìˆ˜ ê´€ë¦¬(player management)</h2>-->
<!--        <div class="player-input-group">-->
<!--            <label for="newSavedName"></label><input type="text" id="newSavedName"-->
<!--                                                     placeholder="ì¶”ê°€í•  ì´ë¦„ ì…ë ¥(Enter a name to add)">-->
<!--            <button class="apply-btn" onclick="addNewSavedName()">ì¶”ê°€(Add)</button>-->
<!--        </div>-->
<!--        <div id="savedNamesList" style="max-height: 50vh; overflow-y: auto; margin-top: 1rem;">-->
<!--            &lt;!&ndash; Saved name items will be populated here &ndash;&gt;-->
<!--        </div>-->
<!--        <div class="modal-footer">-->
<!--            <button class="modal-action" onclick="closeSavedNamesManager()">ë‹«ê¸°(Close)</button>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!-- Player Names Picker ëª¨ë‹¬ -->
<div id="playerNamesPickerModal" class="modal">
    <div class="modal-content" style="width: 95vw; max-width: 400px;">
        <!--        <button class="modal-close" onclick="closePlayerNamesPicker()" aria-label="ë‹«ê¸°(Close)">-->
        <!--            &times;-->
        <!--        </button>-->
        <h2>ì„ ìˆ˜ ì„ íƒ(Player selection)</h2>
        <div id="pickerNamesList"
             style="max-height: 50vh; overflow-y: auto; margin-top: 1rem;"></div>
        <div class="modal-footer">
            <button class="modal-action" onclick="closePlayerNamesPicker()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>

<div id="videoReviewModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0;">ì˜ìƒ í™•ì¸(Check the video)</h2>
        <video id="reviewVideo" controls autoplay loop style="width: 100%;"></video>
        <div class="video-controls">
            <button id="slowPlayBtn" class="modal-action">ëŠë¦¬ê²Œ ì¬ìƒ(Slow)</button>
            <button id="normalPlayBtn" class="modal-action">ë³´í†µ ì¬ìƒ(Normal)</button>
            <!-- Save removed for in-game review; only close/resume exists -->
            <button class="modal-btn" onclick="closeReviewAndResumeRecording()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>

<!-- History playback modal (separate from in-game review) -->
<div id="historyVideoModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0;">ì˜ìƒ ì¬ìƒ(Playback)</h2>
        <video id="historyReviewVideo" controls style="width:100%;"></video>
        <div class="video-controls">
            <button class="modal-btn" onclick="closeHistoryVideo()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>

<!-- End-of-game review modal (shows Save/Cancel) -->
<div id="endGameVideoModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0;">ê²½ê¸° ë…¹í™” ì €ì¥(Record Save)</h2>
        <video id="endGameReviewVideo" controls style="width:100%;"></video>
        <div class="video-controls">
            <button class="modal-btn" onclick="saveReviewedVideo()">ì €ì¥(Save)</button>
            <button class="modal-btn" onclick="closeEndGameModal()">ì·¨ì†Œ(Cancel)</button>
        </div>
    </div>
</div>

<!-- QR Code Modal -->
<div id="qrCodeModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <h2 style="margin-top:0;">ê²½ê¸° ê¸°ë¡ ê³µìœ </h2>
        <div id="qrcode" style=" background: white; display: inline-block;"></div>
        <p style="margin-top: 0rem;">QRì½”ë“œë¥¼ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ìŠ¤ìº”í•˜ì—¬ ê²½ê¸° ê¸°ë¡ì„ ê°€ì ¸ì˜¤ì„¸ìš”.<br>Scan QR code to sync match data with another device.</p>
        <div class="modal-footer">
            <button class="modal-action" onclick="closeQrCodeModal()">ë‹«ê¸°(Close)</button>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="script.js"></script>
</body>

</html>

<!-- Player Stats Modal -->
<div id="playerStatsModal" class="modal">
    <div class="modal-content" style="width:95vw; max-width:720px;">
        <h2>ì„ ìˆ˜ í†µê³„(Player Statistics)</h2>
        <div style="display:flex;gap:12px;flex-direction:column;">
            <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between">
                <div id="playerStatsHeader" style="font-weight:600"></div>
                <div>
                    <button class="modal-action" onclick="closePlayerStats()">ë‹«ê¸°(Close)</button>
                </div>
            </div>
            <div id="playerStatsSummary" style="font-size:0.95rem;color:#444;margin-top:6px"></div>
            <canvas id="playerScoreChart" style="width:100%;height:240px"></canvas>
            <canvas id="playerWinChart" style="width:100%;height:200px"></canvas>
        </div>
    </div>
</div>

<!-- Recording test panel (iOS15+ friendly) - hidden -->
<div id="recordTest" style="display:none;position:fixed;right:12px;bottom:12px;background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);width:320px;z-index:1300;font-family:sans-serif">
    <h4 style="margin:0 0 8px 0;font-size:14px">ë…¹í™” í…ŒìŠ¤íŠ¸(iOS15+)</h4>
    <video id="cameraView" autoplay playsinline muted style="width:100%;background:#000;border-radius:6px;display:none"></video>
    <div id="cameraControls" style="display:none;margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;justify-content:space-between">
        <button id="btnStartCamTest">ì¹´ë©”ë¼ ì‹œì‘(Camera start)</button>
        <button id="btnStartRecTest" disabled>ë…¹í™” ì‹œì‘(Record start)</button>
        <button id="btnStopRecTest" disabled>ì¤‘ì§€(Stop)</button>
        <button id="btnSwitchCamTest">ì¹´ë©”ë¼ ì „í™˜(Change camera)</button>
        <button id="btnAutoRecord5s">ìë™ 5ì´ˆ ë…¹í™”(Auto record)</button>
    </div>
    <a id="downloadLinkTest" style="display:none;margin-top:8px;word-break:break-all"></a>
    <div style="margin-top:8px;font-size:12px;color:#444">
        <strong>í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</strong>
        <div><label><input type="checkbox" id="chkPreview"> ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ</label></div>
        <div><label><input type="checkbox" id="chkRecording"> ë…¹í™” ì‹œì‘/ì¤‘ì§€</label></div>
        <div><label><input type="checkbox" id="chkPlayback"> ë‹¤ìš´ë¡œë“œ/ì¬ìƒ</label></div>
    </div>
    <textarea id="recordTestLog" placeholder="ë¡œê·¸" style="width:100%;height:70px;margin-top:8px;font-size:12px"></textarea>
    <div style="text-align:right;margin-top:6px"><button id="btnClearTestLog">ë¡œê·¸ ì§€ìš°ê¸°</button></div>
</div>